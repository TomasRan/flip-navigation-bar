/* horizontal-scroll-bar 29-04-2016 */
var uiClass=require("/components/common/class/class.js"),$=require("/components/common/base/base.js"),createElement=function(a){return $(document.createElement(a))},HorizontalScrollBar=uiClass().extend({CURSOR:"pointer",SCROLL_BAR:"div",SCROLL_BUTTON:"span",SCROLL_MASK:"div",SCROLL_CONTENT:"div",SCROLL_ITEM:"a",init:function(a){this.checkOptions(a),this.selected=this.options.defaultSelected||"",this.container=this.getContainer(),this.scrollDistance=0,this.scrollItemWidth=0,this.scrollBar=createElement(this.SCROLL_BAR).attr({id:this.options.scrollId,"class":this.options.scrollClass}).css({width:parseFloat(this.scrollBarWidth)+"px",height:parseFloat(this.scrollBarHeight)+"px","white-space":"nowrap",overflow:"hidden"}),this.container.append(this.scrollBar),this.setScrollBarSize(),this.preBtn=this.constructButton(this.options.preBtn,"left"),this.nextBtn=this.constructButton(this.options.nextBtn,"right"),this.scrollBar.append(this.preBtn),this.scrollBar.append(this.nextBtn),this.preBtnWidth=this.getOccupationWidth(this.preBtn)+1,this.nextBtnWidth=this.getOccupationWidth(this.nextBtn)+1,this.bindEvent(this.preBtn,"click",function(a){this.handlePreAction(),this.handleBtn()}.bind(this)),this.bindEvent(this.nextBtn,"click",function(a){this.handleNextAction(),this.handleBtn()}.bind(this)),this.setVisualScrollWidth(),this.render()},setScrollBarSize:function(){this.scrollBarWidth=parseFloat(this.scrollBar.css("width")),this.scrollBarHeight=parseFloat(this.scrollBar.css("height"))},checkOptions:function(a){this.options=$.extend({container:$(document.body),scrollId:"",scrollClass:"",scrollWidth:"",scrollHeight:"",preBtn:{},nextBtn:{},scrollContentClass:"",scrollItemClass:"",itemSelectedClass:"",scrollData:[],statusClassMap:{},defaultSelected:"",jumpToSelected:!0,callback:function(a){console.log(a)}},a)},getContainer:function(){return"object"==typeof this.options.container?this.options.container:"string"==typeof this.options.container?$(this.options.container):void 0},constructButton:function(a,b){return createElement(this.SCROLL_BUTTON).attr({id:a.id,"class":a.className}).css({"float":b,cursor:this.CURSOR}).html(a.content)},setVisualScrollWidth:function(){this.visualScrollWidth=Math.round(this.scrollBarWidth-this.preBtnWidth-this.nextBtnWidth)},constructScrollPart:function(){var a=createElement(this.SCROLL_MASK).css({"float":"left",width:this.visualScrollWidth+"px",overflow:"hidden"}),b=createElement(this.SCROLL_CONTENT).attr({"class":this.options.scrollContentClass});return b.appendTo(a),$.each(this.options.scrollData,function(a,c){var d=createElement(this.SCROLL_ITEM).attr({"class":this.options.scrollItemClass,"data-id":c.id,"data-current-status":c.status}).css({cursor:this.CURSOR}).html(c.content).appendTo(b);d.addClass(this.options.statusClassMap[c.status])}.bind(this)),this.bindEvent(b,"click",function(a){if(a.target.nodeName.toLowerCase()===this.SCROLL_ITEM){var b=$(a.target).attr("data-id");this.select(b,!0)}}.bind(this)),this.scrollContent=b,this.scrollMask=a,a},getTargetById:function(a){return this.scrollBar.find("[data-id="+a+"]")},select:function(a,b){var c=this.getTargetById(a),d={id:a,status:c.attr("data-current-status")};this.clearSelection(),c.addClass(this.options.scrollItemSelectedClass),this.selected=a,!b&&this.options.jumpToSelected&&this.scrollToItem(a),b&&this.options.callback.call(this,d)},clearSelection:function(){this.scrollBar.find(this.SCROLL_ITEM).removeClass(this.options.scrollItemSelectedClass)},setItemStatus:function(a,b){var c=this.getTargetById(a),d=c.attr("data-current-status");c.removeClass(this.options.statusClassMap[d]),c.attr("data-current-status",currentStatus),c.addClass(this.options.statusClassMap[currentStatus])},getOccupationWidth:function(a){var b=parseFloat(a.css("width"))||0,c=parseFloat(a.css("margin-left"))+parseFloat(a.css("margin-right"))||0,d=parseFloat(a.css("padding-left"))+parseFloat(a.css("padding-right"))||0,e=parseFloat(a.css("border-left-width"))+parseFloat(a.css("border-right-width"))||0;return Math.ceil(b+c+d+e)},getTotalScrollWidth:function(){var a=0;return $.each(this.scrollContent.children(),function(b,c){a+=this.getOccupationWidth($(c))}.bind(this)),a},hasNext:function(){return Math.abs(this.scrollDistance)<this.totalScrollWidth-this.visualScrollWidth},hasPre:function(){return this.scrollDistance<0},handleBtn:function(){var a=this.options.preBtn.activeClass,b=this.options.preBtn.disableClass,c=this.options.nextBtn.activeClass,d=this.options.nextBtn.disableClass;this.hasNext()?(this.nextBtn.removeClass(d).addClass(c),this.nextBtn.css("cursor","pointer")):(this.nextBtn.removeClass(c).addClass(d),this.nextBtn.css("cursor","auto")),this.hasPre()?(this.preBtn.removeClass(b).addClass(a),this.preBtn.css("cursor","pointer")):(this.preBtn.removeClass(a).addClass(b),this.preBtn.css("cursor","auto"))},handlePreAction:function(){if(this.hasPre()){var a=Math.abs(this.scrollDistance)/this.scrollItemWidth,b=a-Math.floor(a),c=this.scrollItemWidth*(1-b);this.scrollDistance+=this.visualScrollWidth,this.hasPre()?0!==c&&(this.scrollDistance-=c):this.scrollDistance=0,this.scrollContent.css("margin-left",this.scrollDistance+"px")}},handleNextAction:function(){if(this.hasNext()){this.scrollDistance-=this.visualScrollWidth;var a=Math.abs(this.scrollDistance)/this.scrollItemWidth,b=a-Math.floor(a),c=this.scrollItemWidth*b;this.hasNext()?0!==c&&(this.scrollDistance+=c):this.scrollDistance=this.visualScrollWidth-this.totalScrollWidth,this.scrollContent.css("margin-left",this.scrollDistance+"px")}},scrollToItem:function(a){var b=this.getTargetById(a);return 0===b.length?!1:(this.scrollDistance=-(b.index()*this.scrollItemWidth),this.scrollContent.css("margin-left",this.scrollDistance+"px"),void this.handleBtn())},render:function(){var a=this.constructScrollPart();this.preBtn.after(a),this.totalScrollWidth=this.getTotalScrollWidth(),this.scrollItemWidth=this.totalScrollWidth/this.scrollContent.children().length,this.select(this.selected,!0),this.handleBtn(),$(window).resize(function(){this.setScrollBarSize(),this.setVisualScrollWidth(),this.scrollMask.css({width:this.visualScrollWidth+"px"}),this.handleBtn()}.bind(this))},bindEvent:function(a,b,c){a.on(b,function(a){c(a)})}});module.exports=HorizontalScrollBar;